version: '3'
services:
  builder:
    image: node:14.16.0
    volumes:
      - /:/var/www/html
    container_name: builder
    command: >
      bash -c "cd /var/www/html && yarn install && yarn build && rm -rf production && cp -R dist/* production"

  web:
    depends_on:
      - builder
    image: nginx
    ports:
      - '6969:80'
    restart: always
    volumes:
      - ./config/nginx-custom.conf:/etc/nginx/conf.d/default.conf
      - ./config/mime.types:/etc/nginx/mime.types
      - ./production:/usr/share/nginx/html
    container_name: web
    networks:
      - dota2

  # api:
  #   image: node:14.16.0
  #   ports:
  #     - '3000:3000'
  #   volumes:
  #     - ./backend:/var/www/html
  #   container_name: api
  #   command: >
  #     bash -c "cd /var/www/html && yarn install && yarn start"
  #   networks:
  #     - rs_coding

networks:
  dota2:
    driver: bridge
